{% extends 'blogapp/base.html' %}
{% load static %}

{% block content %}


<!-- Page Header -->
<div class="page-header" id="post-header">
    <div class="background-img" style="background-image: url('/media/{{ post.body_image }}');"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-10">
                <div class="post-meta">
                    <a class="post-category cat-2" href="category.html">{{ post.category }}</a>
                    <span class="post-date">{{ post.created_date }}</span>
                </div>
                <h1>{{ post.title }}</h1>
            </div>
        </div>
    </div>
</div>
<!-- /Page Header -->

<!-- /Header -->

<!-- section -->
<div class="section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">
            <!-- Post content -->
            <div class="col-md-8">
                <div class="section-row sticky-container">
                    <div class="main-post">
                        <h3>{{ post.title }}</h3>
                        <p>{{ post.body_text }}</p>
                        <figure class="figure-img">
                            <img alt="" class="img-responsive" src="/media/posts/detector.png">
                        </figure>
                    </div>
                    <div class="post-shares sticky-shares">
                        <a class="share-facebook" href="#"><i class="fa fa-facebook"></i></a>
                        <a class="share-twitter" href="#"><i class="fa fa-twitter"></i></a>
                        <a class="share-google-plus" href="#"><i class="fa fa-google-plus"></i></a>
                        <a class="share-pinterest" href="#"><i class="fa fa-pinterest"></i></a>
                        <a class="share-linkedin" href="#"><i class="fa fa-linkedin"></i></a>
                        <a href="#"><i class="fa fa-envelope"></i></a>
                    </div>
                </div>

                {% if user.is_authenticated %}
                <a href="{% url 'blogapp:like' 'Post' post.id post.id%}"
                   style="margin: 125px">Like
                    <span class="badge rounded-pill">

                                                 <span class="visually-hidden">{{like_posts.count}}</span>
                                      </span>
                </a>
                {% endif %}

                <!-- ad -->
                <div class="section-row text-center">
                    <a href="#" style="display: inline-block;margin: auto;">
                        <img alt="/static/img/ad-2.jpg" class="img-responsive" src="/static/img/ad-2.jpg">
                    </a>
                </div>
                <!-- /ad -->


                {% if user.is_authenticated %}
                {% if post.user_id == user_id or user_id.is_superuser or user_id.is_moderator %}
                <div class="section-row text-center">
                    <a class="btn btn-primary" href="{% url 'blogapp:edit_post' post.id %}"
                       style="margin: 25px">Редактировать пост</a>
                    <a class="btn btn-primary" href="{% url 'blogapp:delete_post' post.id %}" style="margin: 25px">Удалить
                        пост</a>
                </div>


                {% endif %}
                {% endif %}

                <!-- author -->
                <div class="section-row">
                    <div class="post-author">
                        <div class="media">
                            <div class="media-left">
                                <img alt="" class="media-object" src="/media/{{ post.user_id.avatar }}">
                            </div>
                            <div class="media-body">
                                {% if user.is_authenticated %}
                                <div class="media-heading">
                                    <a href="{% url 'auth:profile' post.user_id.id %}">
                                        Автор: {{ post.user_id }} (перейти в профиль)
                                    </a>
                                </div>
                                {% endif %}
                                <ul class="author-social">
                                    <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                    <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                    <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                    <li><a href="#"><i class="fa fa-instagram"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /author -->
                <div class="row">
                    <div class="col-md-20">
                        {% if user.is_authenticated %}
                        {% if new_comment %}
                        <h2>Your comment has been added.</h2>
                        {% endif %}

                        <h2>Add a new comment</h2>

                        <form action="." method="post">
                            {% csrf_token %}

                            {{ form.user_id.as_hidden }}
                            {{ form.created_date.as_hidden }}
                            {{ form.post_id.as_hidden }}
                            {{ form.is_active.as_hidden }}
                            {{ form.parent_comment_id.as_hidden }}
                            {{ form.head_comment.as_hidden }}

                            <div class="col-md-20">
                                {{ form.body_text }}
                            </div>
                            <p><input type="submit" value="Add comment"></p>
                        </form>
                        {% endif %}
                    </div>
                </div>
                <!-- comments -->
                <div class="section-row">
                    <div class="section-title">
                        <h2>{{ comments.count }} comments</h2>
                    </div>
                    {% for comment in comments %}


                    <div class="post-comments">

                        <div class="media">
                            <div class="media-left">
                                <img alt="" class="media-object" src="/media/{{ comment.user_id.avatar }}">
                            </div>

                            {% if comment.head_comment %}
                            <div class="media-body">
                                <div class="media-heading">
                                    <h4>{{ comment.user_id }} </h4>

                                    <span class="time">{{ comment.created_date }}</span>
                                    {% if user.is_authenticated %}


                                    <!-- отвечать можно только на основной комментарий -->
                                    <a class="reply" href="{% url 'blogapp:comment_reply' comment.id %}">
                                        Reply
                                    </a>

                                    {% if comment.user_id == user_id or user_id.is_superuser or user_id.is_moderator %}
                                    <a class="reply" href="{% url 'blogapp:comment_delete' comment.id %}">
                                        Delete
                                    </a>
                                    <a class="reply" href="{% url 'blogapp:comment_update' comment.id post.id %}">
                                        Update
                                    </a>
                                    {% endif %}

                                    {% endif %}
                                    {% if user.is_authenticated %}


                                    <a href="{% url 'blogapp:like' 'Comment' post.id comment.id %}"
                                       style="margin: 25px">Likes
                                        <span class="badge rounded-pill">

                                            <span class="visually-hidden">{{comment.total_likes}}</span>
                                          </span>
                                    </a>


                                    {% endif %}


                                </div>
                                <p>{{ comment.body_text }}</p>
                            </div>
                            {% else %}
                            <div class="media-body">
                                <div class="media-heading-reply">
                                    <h5>{{ comment.user_id }}</h5>

                                    <span class="time">{{ comment.created_date }}</span>
                                    {% if user.is_authenticated %}

                                    {% if comment.user_id == user_id or user_id.is_superuser or user_id.is_moderator %}
                                    <a class="reply" href="{% url 'blogapp:comment_delete' comment.id %}">
                                        Delete
                                    </a>
                                    <a class="reply" href="{% url 'blogapp:comment_update' comment.id post.id %}">
                                        Update
                                    </a>
                                    {% endif %}


                                    <a href="{% url 'blogapp:like' 'Comment' post.id comment.id %}"
                                       style="margin: 25px">Like
                                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">

                                                <span class="visually-hidden">{{comment.total_likes}}</span>
                                            </span>
                                    </a>


                                    {% endif %}


                                    <p>{{ comment.body_text }}</p>
                                </div>
                            </div>

                            {% endif %}

                        </div>

                        {% endfor %}
                    </div>
                </div>


            </div>
            <!-- /reply -->
        </div>

    </div>
    <!-- /container -->
</div>
<!-- /section -->

<!-- Footer -->


<!-- jQuery Plugins -->
<script src="../../static/js/jquery.min.js"></script>
<script src="../../static/js/bootstrap.min.js"></script>
<script src="../../static/js/main.js"></script>

</body>

{% endblock %}